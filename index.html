<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人记账助手</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/lucide@0.544.0/dist/umd/lucide.min.js"></script>
    <style>
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">
    <div id="app" class="max-w-md mx-auto h-screen bg-white shadow-lg flex flex-col">
        <!-- 页面内容区域 -->
        <main class="flex-1 overflow-y-auto">
            <!-- 首页 -->
            <div id="home-page" class="page active p-4 pb-20">
                <h1 class="text-2xl font-bold text-center my-4">记账</h1>
                
                <!-- 日期范围筛选 -->
                <div class="mb-4">
                    <label for="date-range" class="block text-sm font-medium text-gray-700 mb-1">日期范围</label>
                    <select id="date-range" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="this-month">本月</option>
                        <option value="last-month">上月</option>
                        <option value="this-year">本年</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>

                <!-- 收支概览 -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">支出</p>
                        <p class="text-xl font-bold text-red-500" id="total-expense">¥0.00</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">收入</p>
                        <p class="text-xl font-bold text-green-500" id="total-income">¥0.00</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">结余</p>
                        <p class="text-xl font-bold text-blue-500" id="balance">¥0.00</p>
                    </div>
                </div>

                <!-- 预算信息 -->
                <div class="bg-gray-50 p-4 rounded-lg mb-6">
                    <h2 class="font-bold mb-2">预算</h2>
                    <div class="flex justify-between mb-1">
                        <span class="text-sm">已使用</span>
                        <span class="text-sm font-medium" id="used-budget">¥0.00 / ¥0.00</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div class="bg-blue-600 h-2.5 rounded-full" id="budget-progress" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-right mt-1 text-gray-600" id="remaining-budget">剩余: ¥0.00</p>
                </div>

                <!-- 今日概览 -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">今日支出</p>
                        <p class="text-lg font-bold" id="today-expense">¥0.00</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">总记录数</p>
                        <p class="text-lg font-bold" id="total-records">0</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">日均支出</p>
                        <p class="text-lg font-bold" id="avg-daily-expense">¥0.00</p>
                    </div>
                </div>

                <!-- 记一笔按钮 -->
                <button id="add-record-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold mb-6">
                    记一笔
                </button>

                <!-- 账单筛选 -->
                <div class="flex justify-between mb-4">
                    <select id="time-filter" class="p-2 border border-gray-300 rounded-md">
                        <option value="all">全部时间</option>
                        <option value="today">本日</option>
                        <option value="week">本周</option>
                        <option value="month">本月</option>
                        <option value="year">本年</option>
                        <option value="custom">自定义</option>
                    </select>
                    <select id="type-filter" class="p-2 border border-gray-300 rounded-md">
                        <option value="all">全部类型</option>
                        <option value="expense">支出</option>
                        <option value="income">收入</option>
                    </select>
                </div>

                <!-- 账单列表 -->
                <div class="space-y-3" id="bill-list">
                    <!-- 账单记录将在这里动态生成 -->
                    <p class="text-center text-gray-500 py-8">暂无账单记录</p>
                </div>
            </div>

            <!-- 统计页 -->
            <div id="stats-page" class="page p-4 pb-20">
                <h1 class="text-2xl font-bold text-center my-4">统计</h1>
                
                <!-- 时间维度筛选 -->
                <div class="flex mb-6 bg-gray-100 p-1 rounded-lg">
                    <button class="flex-1 py-2 rounded-md text-sm font-medium stats-period-btn active" data-period="week">本周</button>
                    <button class="flex-1 py-2 rounded-md text-sm font-medium stats-period-btn" data-period="month">本月</button>
                    <button class="flex-1 py-2 rounded-md text-sm font-medium stats-period-btn" data-period="year">本年</button>
                </div>

                <!-- 收支统计卡片 -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">支出</p>
                        <p class="text-xl font-bold text-red-500" id="stats-expense">¥0.00</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">收入</p>
                        <p class="text-xl font-bold text-green-500" id="stats-income">¥0.00</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">净收入</p>
                        <p class="text-xl font-bold text-blue-500" id="stats-net">¥0.00</p>
                    </div>
                </div>

                <!-- 趋势分析图表 -->
                <div class="bg-white p-4 rounded-lg shadow mb-6">
                    <h3 class="font-bold mb-4">趋势分析</h3>
                    <canvas id="trend-chart" width="400" height="200"></canvas>
                </div>

                <!-- 支出分类统计 -->
                <div class="bg-white p-4 rounded-lg shadow mb-6">
                    <h3 class="font-bold mb-4">支出分类</h3>
                    <canvas id="expense-category-chart" width="400" height="200"></canvas>
                </div>

                <!-- 收入分类统计 -->
                <div class="bg-white p-4 rounded-lg shadow">
                    <h3 class="font-bold mb-4">收入分类</h3>
                    <canvas id="income-category-chart" width="400" height="200"></canvas>
                </div>
            </div>

            <!-- 资产页 -->
            <div id="assets-page" class="page p-4 pb-20">
                <h1 class="text-2xl font-bold text-center my-4">资产</h1>
                
                <!-- 资产概览 -->
                <div class="grid grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">累计投资</p>
                        <p class="text-xl font-bold text-blue-500" id="total-investment">¥0.00</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">累计收益</p>
                        <p class="text-xl font-bold text-green-500" id="total-profit">¥0.00</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-gray-600">平均年化</p>
                        <p class="text-xl font-bold text-purple-500" id="avg-annual-rate">0.00%</p>
                    </div>
                </div>

                <!-- 投资趋势图表 -->
                <div class="bg-white p-4 rounded-lg shadow mb-6">
                    <div class="flex justify-between mb-4">
                        <h3 class="font-bold">投资趋势</h3>
                        <select id="trend-type" class="text-sm border border-gray-300 rounded-md p-1">
                            <option value="investment">累计投资</option>
                            <option value="profit">累计收益</option>
                            <option value="rate">年化收益率</option>
                        </select>
                    </div>
                    <canvas id="investment-chart" width="400" height="200"></canvas>
                </div>

                <!-- 添加理财产品按钮 -->
                <button id="add-product-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold mb-6">
                    添加理财产品
                </button>

                <!-- 理财产品列表 -->
                <div class="mb-6">
                    <h3 class="font-bold mb-3">我的理财产品</h3>
                    <div id="product-list" class="space-y-3">
                        <!-- 产品列表将在这里动态生成 -->
                        <p class="text-center text-gray-500 py-4">暂无理财产品</p>
                    </div>
                </div>

                <!-- 投资记录列表 -->
                <div>
                    <h3 class="font-bold mb-3">投资记录</h3>
                    <div id="investment-records" class="space-y-2 text-sm">
                        <!-- 记录列表将在这里动态生成 -->
                        <p class="text-center text-gray-500 py-4">暂无投资记录</p>
                    </div>
                </div>
            </div>

            <!-- 归纳页 -->
            <div id="items-page" class="page p-4 pb-20">
                <h1 class="text-2xl font-bold text-center my-4">归纳</h1>
                
                <!-- 添加物品按钮 -->
                <button id="add-item-btn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-bold mb-6">
                    添加物品
                </button>

                <!-- 物品分类筛选 -->
                <div class="mb-4">
                    <select id="item-category-filter" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="all">全部分类</option>
                        <option value="food">食品</option>
                        <option value="daily">日用品</option>
                        <option value="electronics">电子产品</option>
                        <option value="clothing">服装</option>
                        <option value="other">其他</option>
                    </select>
                </div>

                <!-- 物品列表 -->
                <div id="item-list" class="space-y-3">
                    <!-- 物品列表将在这里动态生成 -->
                    <p class="text-center text-gray-500 py-8">暂无物品记录</p>
                </div>
            </div>

            <!-- 我的页 -->
            <div id="profile-page" class="page p-4 pb-20">
                <h1 class="text-2xl font-bold text-center my-4">我的</h1>
                
                <!-- 设置选项列表 -->
                <div class="space-y-4">
                    <!-- 记账设置 -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-bold">记账设置</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <button class="w-full text-left p-4 flex justify-between items-center" id="budget-settings-btn">
                                <span>预算管理</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="category-settings-btn">
                                <span>分类管理</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 归纳设置 -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-bold">归纳设置</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <button class="w-full text-left p-4 flex justify-between items-center" id="item-category-settings-btn">
                                <span>分类管理</span>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 数据管理 -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="p-4 border-b border-gray-200">
                            <h3 class="font-bold">数据管理</h3>
                        </div>
                        <div class="divide-y divide-gray-200">
                            <button class="w-full text-left p-4 flex justify-between items-center" id="export-bill-data-btn">
                                <span>导出记账数据</span>
                                <i data-lucide="download" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="import-bill-data-btn">
                                <span>导入记账数据</span>
                                <i data-lucide="upload" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="export-asset-data-btn">
                                <span>导出资产数据</span>
                                <i data-lucide="download" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="import-asset-data-btn">
                                <span>导入资产数据</span>
                                <i data-lucide="upload" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="export-item-data-btn">
                                <span>导出归纳数据</span>
                                <i data-lucide="download" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            <button class="w-full text-left p-4 flex justify-between items-center" id="import-item-data-btn">
                                <span>导入归纳数据</span>
                                <i data-lucide="upload" class="w-5 h-5 text-gray-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 其他 -->
                    <div class="bg-white rounded-lg shadow overflow-hidden">
                        <div class="divide-y divide-gray-200">
                            <button class="w-full text-left p-4 flex justify-between items-center text-red-500" id="clear-all-data-btn">
                                <span>清空所有数据</span>
                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- 模态框容器 -->
        <div id="modals-container"></div>

        <!-- 底部导航栏 -->
        <nav class="bg-white border-t border-gray-200 fixed bottom-0 w-full max-w-md mx-auto">
            <ul class="flex justify-around h-16">
                <li id="nav-home" class="nav-item active flex flex-col items-center justify-center" data-page="home-page">
                    <i data-lucide="home" class="w-6 h-6 text-blue-500"></i>
                    <span class="text-xs mt-1 text-blue-500">首页</span>
                </li>
                <li id="nav-stats" class="nav-item flex flex-col items-center justify-center" data-page="stats-page">
                    <i data-lucide="bar-chart-2" class="w-6 h-6 text-gray-500"></i>
                    <span class="text-xs mt-1 text-gray-500">统计</span>
                </li>
                <li id="nav-assets" class="nav-item flex flex-col items-center justify-center" data-page="assets-page">
                    <i data-lucide="wallet" class="w-6 h-6 text-gray-500"></i>
                    <span class="text-xs mt-1 text-gray-500">资产</span>
                </li>
                <li id="nav-items" class="nav-item flex flex-col items-center justify-center" data-page="items-page">
                    <i data-lucide="package" class="w-6 h-6 text-gray-500"></i>
                    <span class="text-xs mt-1 text-gray-500">归纳</span>
                </li>
                <li id="nav-profile" class="nav-item flex flex-col items-center justify-center" data-page="profile-page">
                    <i data-lucide="user" class="w-6 h-6 text-gray-500"></i>
                    <span class="text-xs mt-1 text-gray-500">我的</span>
                </li>
            </ul>
        </nav>
    </div>

    <script>
        // 数据存储
        const AppData = {
            bills: JSON.parse(localStorage.getItem('bills')) || [],
            assets: JSON.parse(localStorage.getItem('assets')) || [],
            items: JSON.parse(localStorage.getItem('items')) || [],
            budget: JSON.parse(localStorage.getItem('budget')) || { monthly: 0 },
            categories: JSON.parse(localStorage.getItem('categories')) || {
                expense: ['餐饮', '交通', '购物', '娱乐', '医疗', '教育', '其他'],
                income: ['工资', '奖金', '投资', '兼职', '其他']
            },
            itemCategories: JSON.parse(localStorage.getItem('itemCategories')) || ['食品', '日用品', '电子产品', '服装', '其他'],

            saveData() {
                localStorage.setItem('bills', JSON.stringify(this.bills));
                localStorage.setItem('assets', JSON.stringify(this.assets));
                localStorage.setItem('items', JSON.stringify(this.items));
                localStorage.setItem('budget', JSON.stringify(this.budget));
                localStorage.setItem('categories', JSON.stringify(this.categories));
                localStorage.setItem('itemCategories', JSON.stringify(this.itemCategories));
            }
        };

        // 工具函数
        const Utils = {
            formatMoney(amount) {
                return `¥${parseFloat(amount).toFixed(2)}`;
            },
            
            formatDate(date) {
                const d = new Date(date);
                return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}-${String(d.getDate()).padStart(2, '0')}`;
            },

            getDateRange(range) {
                const now = new Date();
                const start = new Date();
                const end = new Date();

                switch (range) {
                    case 'today':
                        start.setHours(0, 0, 0, 0);
                        end.setHours(23, 59, 59, 999);
                        break;
                    case 'week':
                        const day = now.getDay() || 7;
                        start.setDate(now.getDate() - day + 1);
                        start.setHours(0, 0, 0, 0);
                        end.setDate(now.getDate() + (7 - day));
                        end.setHours(23, 59, 59, 999);
                        break;
                    case 'month':
                        start.setDate(1);
                        start.setHours(0, 0, 0, 0);
                        end.setMonth(now.getMonth() + 1, 0);
                        end.setHours(23, 59, 59, 999);
                        break;
                    case 'year':
                        start.setMonth(0, 1);
                        start.setHours(0, 0, 0, 0);
                        end.setMonth(11, 31);
                        end.setHours(23, 59, 59, 999);
                        break;
                    default:
                        return { start: null, end: null };
                }

                return { start, end };
            },

            filterBills(bills, filters) {
                return bills.filter(bill => {
                    const billDate = new Date(bill.date);
                    let dateMatch = true;
                    let typeMatch = true;

                    if (filters.dateRange) {
                        const { start, end } = this.getDateRange(filters.dateRange);
                        if (start && end) {
                            dateMatch = billDate >= start && billDate <= end;
                        }
                    }

                    if (filters.type && filters.type !== 'all') {
                        typeMatch = bill.type === filters.type;
                    }

                    return dateMatch && typeMatch;
                });
            }
        };

        // 页面渲染
        const Renderer = {
            renderHomePage() {
                const bills = Utils.filterBills(AppData.bills, { dateRange: 'month' });
                const expense = bills.filter(b => b.type === 'expense').reduce((sum, b) => sum + b.amount, 0);
                const income = bills.filter(b => b.type === 'income').reduce((sum, b) => sum + b.amount, 0);
                const balance = income - expense;

                document.getElementById('total-expense').textContent = Utils.formatMoney(expense);
                document.getElementById('total-income').textContent = Utils.formatMoney(income);
                document.getElementById('balance').textContent = Utils.formatMoney(balance);

                // 预算信息
                const budget = AppData.budget.monthly || 0;
                const usedPercentage = budget > 0 ? (expense / budget) * 100 : 0;
                document.getElementById('used-budget').textContent = `${Utils.formatMoney(expense)} / ${Utils.formatMoney(budget)}`;
                document.getElementById('budget-progress').style.width = `${Math.min(usedPercentage, 100)}%`;
                document.getElementById('remaining-budget').textContent = `剩余: ${Utils.formatMoney(budget - expense)}`;

                // 今日概览
                const todayBills = Utils.filterBills(AppData.bills, { dateRange: 'today' });
                const todayExpense = todayBills.filter(b => b.type === 'expense').reduce((sum, b) => sum + b.amount, 0);
                document.getElementById('today-expense').textContent = Utils.formatMoney(todayExpense);
                document.getElementById('total-records').textContent = AppData.bills.length;
                
                const avgDailyExpense = bills.length > 0 ? expense / bills.length : 0;
                document.getElementById('avg-daily-expense').textContent = Utils.formatMoney(avgDailyExpense);

                // 渲染账单列表
                this.renderBillList();
            },

            renderBillList(filters = { dateRange: 'month', type: 'all' }) {
                const billList = document.getElementById('bill-list');
                const filteredBills = Utils.filterBills(AppData.bills, filters);

                if (filteredBills.length === 0) {
                    billList.innerHTML = '<p class="text-center text-gray-500 py-8">暂无账单记录</p>';
                    return;
                }

                const groupedBills = this.groupBillsByDate(filteredBills);
                let html = '';

                Object.keys(groupedBills).forEach(date => {
                    html += `<div class="mb-4">
                        <p class="text-sm text-gray-500 mb-2">${date}</p>
                        <div class="space-y-2">`;
                    
                    groupedBills[date].forEach(bill => {
                        const color = bill.type === 'expense' ? 'text-red-500' : 'text-green-500';
                        const sign = bill.type === 'expense' ? '-' : '+';
                        html += `<div class="bg-white p-3 rounded-lg shadow-sm flex justify-between items-center">
                            <div>
                                <p class="font-medium">${bill.category}</p>
                                <p class="text-xs text-gray-500">${bill.note || ''}</p>
                            </div>
                            <p class="font-bold ${color}">${sign}${Utils.formatMoney(bill.amount)}</p>
                        </div>`;
                    });
                    
                    html += `</div></div>`;
                });

                billList.innerHTML = html;
            },

            groupBillsByDate(bills) {
                const grouped = {};
                bills.forEach(bill => {
                    const date = Utils.formatDate(bill.date);
                    if (!grouped[date]) {
                        grouped[date] = [];
                    }
                    grouped[date].push(bill);
                });
                return grouped;
            },

            renderStatsPage(period = 'week') {
                const bills = Utils.filterBills(AppData.bills, { dateRange: period });
                const expense = bills.filter(b => b.type === 'expense').reduce((sum, b) => sum + b.amount, 0);
                const income = bills.filter(b => b.type === 'income').reduce((sum, b) => sum + b.amount, 0);
                const net = income - expense;

                document.getElementById('stats-expense').textContent = Utils.formatMoney(expense);
                document.getElementById('stats-income').textContent = Utils.formatMoney(income);
                document.getElementById('stats-net').textContent = Utils.formatMoney(net);

                // TODO: 渲染图表
            },

            renderAssetsPage() {
                const totalInvestment = AppData.assets.reduce((sum, a) => sum + a.currentAmount, 0);
                const totalProfit = AppData.assets.reduce((sum, a) => sum + a.totalProfit, 0);
                const avgAnnualRate = AppData.assets.length > 0 
                    ? (AppData.assets.reduce((sum, a) => sum + a.annualRate, 0) / AppData.assets.length) * 100 
                    : 0;

                document.getElementById('total-investment').textContent = Utils.formatMoney(totalInvestment);
                document.getElementById('total-profit').textContent = Utils.formatMoney(totalProfit);
                document.getElementById('avg-annual-rate').textContent = `${avgAnnualRate.toFixed(2)}%`;

                // 渲染产品列表
                this.renderProductList();
            },

            renderProductList() {
                const productList = document.getElementById('product-list');
                if (AppData.assets.length === 0) {
                    productList.innerHTML = '<p class="text-center text-gray-500 py-4">暂无理财产品</p>';
                    return;
                }

                let html = '';
                AppData.assets.forEach(product => {
                    html += `<div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <p class="font-bold">${product.name}</p>
                                <p class="text-xs text-gray-500">${product.channel} | ${product.code}</p>
                            </div>
                            <button class="text-blue-500 text-sm record-btn" data-id="${product.id}">记录</button>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">累计收益</span>
                            <span class="font-medium text-green-500">${Utils.formatMoney(product.totalProfit)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-600">年化收益率</span>
                            <span class="font-medium text-purple-500">${(product.annualRate * 100).toFixed(2)}%</span>
                        </div>
                    </div>`;
                });

                productList.innerHTML = html;
            },

            renderItemsPage(category = 'all') {
                const itemList = document.getElementById('item-list');
                const filteredItems = category === 'all' 
                    ? AppData.items 
                    : AppData.items.filter(item => item.category === category);

                if (filteredItems.length === 0) {
                    itemList.innerHTML = '<p class="text-center text-gray-500 py-8">暂无物品记录</p>';
                    return;
                }

                let html = '';
                filteredItems.forEach(item => {
                    const expired = new Date(item.expiryDate) < new Date();
                    const expiryClass = expired ? 'text-red-500' : 'text-gray-600';
                    
                    html += `<div class="bg-white p-4 rounded-lg shadow-sm">
                        <div class="flex justify-between items-start">
                            <div>
                                <p class="font-bold">${item.name}</p>
                                <p class="text-xs text-gray-500">${item.category}</p>
                            </div>
                            <span class="${expiryClass} text-sm">${Utils.formatDate(item.expiryDate)}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-2">购入时间: ${Utils.formatDate(item.purchaseDate)}</p>
                        ${item.notes ? `<p class="text-sm text-gray-500 mt-1">${item.notes}</p>` : ''}
                    </div>`;
                });

                itemList.innerHTML = html;
            }
        };

        // 事件处理
        const EventHandler = {
            init() {
                console.log('Initializing event handlers...');

                // 为每个导航项单独绑定事件
                document.getElementById('nav-home').addEventListener('click', () => this.switchPage('home-page'));
                document.getElementById('nav-stats').addEventListener('click', () => this.switchPage('stats-page'));
                document.getElementById('nav-assets').addEventListener('click', () => this.switchPage('assets-page'));
                document.getElementById('nav-items').addEventListener('click', () => this.switchPage('items-page'));
                document.getElementById('nav-profile').addEventListener('click', () => this.switchPage('profile-page'));

                // 首页筛选
                document.getElementById('time-filter').addEventListener('change', (e) => {
                    const type = document.getElementById('type-filter').value;
                    Renderer.renderBillList({ dateRange: e.target.value, type });
                });

                document.getElementById('type-filter').addEventListener('change', (e) => {
                    const time = document.getElementById('time-filter').value;
                    Renderer.renderBillList({ dateRange: time, type: e.target.value });
                });

                // 统计页筛选
                document.querySelectorAll('.stats-period-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        document.querySelectorAll('.stats-period-btn').forEach(b => b.classList.remove('active', 'bg-blue-500', 'text-white'));
                        btn.classList.add('active', 'bg-blue-500', 'text-white');
                        Renderer.renderStatsPage(btn.getAttribute('data-period'));
                    });
                });

                // 归纳页分类筛选
                document.getElementById('item-category-filter').addEventListener('change', (e) => {
                    Renderer.renderItemsPage(e.target.value);
                });

                // 记一笔按钮
                document.getElementById('add-record-btn').addEventListener('click', () => {
                    Modal.showAddBillModal();
                });

                // 添加理财产品按钮
                document.getElementById('add-product-btn').addEventListener('click', () => {
                    Modal.showAddProductModal();
                });

                // 添加物品按钮
                document.getElementById('add-item-btn').addEventListener('click', () => {
                    Modal.showAddItemModal();
                });
            },

            switchPage(pageId) {
                console.log(`Switching to page: ${pageId}`);
                
                // 更新导航栏样式
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(nav => {
                    nav.classList.remove('active');
                    const icon = nav.querySelector('i');
                    const span = nav.querySelector('span');
                    if (icon) {
                        icon.classList.remove('text-blue-500');
                        icon.classList.add('text-gray-500');
                    }
                    if (span) {
                        span.classList.remove('text-blue-500');
                        span.classList.add('text-gray-500');
                    }
                });

                // 激活当前页
                const activeNav = document.querySelector(`[data-page="${pageId}"]`);
                if (activeNav) {
                    activeNav.classList.add('active');
                    const icon = activeNav.querySelector('i');
                    const span = activeNav.querySelector('span');
                    if (icon) {
                        icon.classList.remove('text-gray-500');
                        icon.classList.add('text-blue-500');
                    }
                    if (span) {
                        span.classList.remove('text-gray-500');
                        span.classList.add('text-blue-500');
                    }
                }

                // 显示对应页面
                document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.add('active');
                } else {
                    console.error(`Page with ID ${pageId} not found!`);
                }
                
                // 页面特定渲染
                switch (pageId) {
                    case 'home-page':
                        Renderer.renderHomePage();
                        break;
                    case 'stats-page':
                        Renderer.renderStatsPage();
                        break;
                    case 'assets-page':
                        Renderer.renderAssetsPage();
                        break;
                    case 'items-page':
                        Renderer.renderItemsPage();
                        break;
                    case 'profile-page':
                        // 个人页面暂无特定渲染逻辑
                        break;
                    default:
                        console.warn(`No specific rendering for page: ${pageId}`);
                }
            }
        };

        // 模态框
        const Modal = {
            showAddBillModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg w-full max-w-md p-6">
                        <h2 class="text-xl font-bold mb-4">记一笔</h2>
                        <form id="add-bill-form">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">类型</label>
                                <div class="flex">
                                    <button type="button" class="flex-1 py-2 rounded-l-md border border-gray-300 bg-red-50 text-red-500 bill-type-btn active" data-type="expense">支出</button>
                                    <button type="button" class="flex-1 py-2 rounded-r-md border border-gray-300 bill-type-btn" data-type="income">收入</button>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="bill-amount" class="block text-sm font-medium text-gray-700 mb-1">金额</label>
                                <input type="number" id="bill-amount" class="w-full p-2 border border-gray-300 rounded-md" step="0.01" required>
                            </div>
                            <div class="mb-4">
                                <label for="bill-category" class="block text-sm font-medium text-gray-700 mb-1">分类</label>
                                <select id="bill-category" class="w-full p-2 border border-gray-300 rounded-md" required></select>
                            </div>
                            <div class="mb-4">
                                <label for="bill-date" class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                                <input type="date" id="bill-date" class="w-full p-2 border border-gray-300 rounded-md" required>
                            </div>
                            <div class="mb-4">
                                <label for="bill-note" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                                <input type="text" id="bill-note" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <div class="flex space-x-4">
                                <button type="button" class="flex-1 py-2 bg-gray-300 text-gray-700 rounded-md cancel-btn">取消</button>
                                <button type="submit" class="flex-1 py-2 bg-blue-500 text-white rounded-md">确定</button>
                            </div>
                        </form>
                    </div>
                `;

                document.getElementById('modals-container').appendChild(modal);

                // 设置默认日期
                const today = new Date();
                const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                document.getElementById('bill-date').value = dateString;

                // 类型切换
                const typeBtns = modal.querySelectorAll('.bill-type-btn');
                const categorySelect = document.getElementById('bill-category');
                
                const updateCategories = (type) => {
                    categorySelect.innerHTML = '';
                    AppData.categories[type].forEach(cat => {
                        const option = document.createElement('option');
                        option.value = cat;
                        option.textContent = cat;
                        categorySelect.appendChild(option);
                    });
                };

                typeBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        typeBtns.forEach(b => b.classList.remove('active', 'bg-red-50', 'text-red-500', 'bg-green-50', 'text-green-500'));
                        const type = btn.getAttribute('data-type');
                        if (type === 'expense') {
                            btn.classList.add('active', 'bg-red-50', 'text-red-500');
                        } else {
                            btn.classList.add('active', 'bg-green-50', 'text-green-500');
                        }
                        updateCategories(type);
                    });
                });

                // 初始化分类
                updateCategories('expense');

                // 取消按钮
                modal.querySelector('.cancel-btn').addEventListener('click', () => {
                    modal.remove();
                });

                // 表单提交
                modal.querySelector('#add-bill-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const type = modal.querySelector('.bill-type-btn.active').getAttribute('data-type');
                    const amount = parseFloat(document.getElementById('bill-amount').value);
                    const category = document.getElementById('bill-category').value;
                    const date = document.getElementById('bill-date').value;
                    const note = document.getElementById('bill-note').value;

                    AppData.bills.push({
                        id: Date.now().toString(),
                        type,
                        amount,
                        category,
                        date,
                        note,
                        createdAt: new Date().toISOString()
                    });

                    AppData.saveData();
                    Renderer.renderHomePage();
                    modal.remove();
                });
            },

            showAddProductModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg w-full max-w-md p-6">
                        <h2 class="text-xl font-bold mb-4">添加理财产品</h2>
                        <form id="add-product-form">
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="product-channel" class="block text-sm font-medium text-gray-700 mb-1">渠道</label>
                                    <input type="text" id="product-channel" class="w-full p-2 border border-gray-300 rounded-md" required>
                                </div>
                                <div>
                                    <label for="product-name" class="block text-sm font-medium text-gray-700 mb-1">名称</label>
                                    <input type="text" id="product-name" class="w-full p-2 border border-gray-300 rounded-md" required>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="product-code" class="block text-sm font-medium text-gray-700 mb-1">代码</label>
                                    <input type="text" id="product-code" class="w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="product-risk" class="block text-sm font-medium text-gray-700 mb-1">风险等级</label>
                                    <select id="product-risk" class="w-full p-2 border border-gray-300 rounded-md">
                                        <option value="R1">R1</option>
                                        <option value="R2">R2</option>
                                        <option value="R3">R3</option>
                                        <option value="R4">R4</option>
                                        <option value="R5">R5</option>
                                    </select>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="product-min-amount" class="block text-sm font-medium text-gray-700 mb-1">起投金额</label>
                                    <input type="number" id="product-min-amount" class="w-full p-2 border border-gray-300 rounded-md" step="0.01">
                                </div>
                                <div>
                                    <label for="product-start-date" class="block text-sm font-medium text-gray-700 mb-1">开始日期</label>
                                    <input type="date" id="product-start-date" class="w-full p-2 border border-gray-300 rounded-md" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="product-rules" class="block text-sm font-medium text-gray-700 mb-1">交易规则</label>
                                <input type="text" id="product-rules" class="w-full p-2 border border-gray-300 rounded-md">
                            </div>
                            <hr class="my-4">
                            <h3 class="font-bold mb-2">投资信息</h3>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="investment-amount" class="block text-sm font-medium text-gray-700 mb-1">投资金额</label>
                                    <input type="number" id="investment-amount" class="w-full p-2 border border-gray-300 rounded-md" step="0.01" required>
                                </div>
                                <div>
                                    <label for="record-date" class="block text-sm font-medium text-gray-700 mb-1">记录日期</label>
                                    <input type="date" id="record-date" class="w-full p-2 border border-gray-300 rounded-md" required>
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="product-notes" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                                <textarea id="product-notes" class="w-full p-2 border border-gray-300 rounded-md" rows="2"></textarea>
                            </div>
                            <div class="flex space-x-4">
                                <button type="button" class="flex-1 py-2 bg-gray-300 text-gray-700 rounded-md cancel-btn">取消</button>
                                <button type="submit" class="flex-1 py-2 bg-blue-500 text-white rounded-md">确定</button>
                            </div>
                        </form>
                    </div>
                `;

                document.getElementById('modals-container').appendChild(modal);

                // 设置默认日期
                const today = new Date();
                const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                document.getElementById('record-date').value = dateString;
                document.getElementById('product-start-date').value = dateString;

                // 取消按钮
                modal.querySelector('.cancel-btn').addEventListener('click', () => {
                    modal.remove();
                });

                // 表单提交
                modal.querySelector('#add-product-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const product = {
                        id: Date.now().toString(),
                        channel: document.getElementById('product-channel').value,
                        name: document.getElementById('product-name').value,
                        code: document.getElementById('product-code').value,
                        riskLevel: document.getElementById('product-risk').value,
                        minAmount: parseFloat(document.getElementById('product-min-amount').value) || 0,
                        startDate: document.getElementById('product-start-date').value,
                        rules: document.getElementById('product-rules').value,
                        currentAmount: parseFloat(document.getElementById('investment-amount').value),
                        totalProfit: 0,
                        annualRate: 0,
                        notes: document.getElementById('product-notes').value,
                        records: [{
                            date: document.getElementById('record-date').value,
                            amount: parseFloat(document.getElementById('investment-amount').value),
                            profit: 0,
                            rate: 0
                        }]
                    };

                    AppData.assets.push(product);
                    AppData.saveData();
                    Renderer.renderAssetsPage();
                    modal.remove();
                });
            },

            showAddItemModal() {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                modal.innerHTML = `
                    <div class="bg-white rounded-lg w-full max-w-md p-6">
                        <h2 class="text-xl font-bold mb-4">添加物品</h2>
                        <form id="add-item-form">
                            <div class="mb-4">
                                <label for="item-name" class="block text-sm font-medium text-gray-700 mb-1">物品名称</label>
                                <input type="text" id="item-name" class="w-full p-2 border border-gray-300 rounded-md" required>
                            </div>
                            <div class="mb-4">
                                <label for="item-category" class="block text-sm font-medium text-gray-700 mb-1">分类</label>
                                <select id="item-category" class="w-full p-2 border border-gray-300 rounded-md" required></select>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="purchase-date" class="block text-sm font-medium text-gray-700 mb-1">购入时间</label>
                                    <input type="date" id="purchase-date" class="w-full p-2 border border-gray-300 rounded-md" required>
                                </div>
                                <div>
                                    <label for="production-date" class="block text-sm font-medium text-gray-700 mb-1">生产日期</label>
                                    <input type="date" id="production-date" class="w-full p-2 border border-gray-300 rounded-md">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label for="expiry-date" class="block text-sm font-medium text-gray-700 mb-1">过期日期</label>
                                    <input type="date" id="expiry-date" class="w-full p-2 border border-gray-300 rounded-md">
                                </div>
                                <div>
                                    <label for="remind-days" class="block text-sm font-medium text-gray-700 mb-1">提前提醒(天)</label>
                                    <input type="number" id="remind-days" class="w-full p-2 border border-gray-300 rounded-md" min="0">
                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="item-notes" class="block text-sm font-medium text-gray-700 mb-1">备注</label>
                                <textarea id="item-notes" class="w-full p-2 border border-gray-300 rounded-md" rows="2"></textarea>
                            </div>
                            <div class="flex space-x-4">
                                <button type="button" class="flex-1 py-2 bg-gray-300 text-gray-700 rounded-md cancel-btn">取消</button>
                                <button type="submit" class="flex-1 py-2 bg-blue-500 text-white rounded-md">确定</button>
                            </div>
                        </form>
                    </div>
                `;

                document.getElementById('modals-container').appendChild(modal);

                // 设置默认日期
                const today = new Date();
                const dateString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
                document.getElementById('purchase-date').value = dateString;

                // 填充分类
                const categorySelect = document.getElementById('item-category');
                AppData.itemCategories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    categorySelect.appendChild(option);
                });

                // 取消按钮
                modal.querySelector('.cancel-btn').addEventListener('click', () => {
                    modal.remove();
                });

                // 表单提交
                modal.querySelector('#add-item-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    
                    const item = {
                        id: Date.now().toString(),
                        name: document.getElementById('item-name').value,
                        category: document.getElementById('item-category').value,
                        purchaseDate: document.getElementById('purchase-date').value,
                        productionDate: document.getElementById('production-date').value,
                        expiryDate: document.getElementById('expiry-date').value,
                        remindDays: parseInt(document.getElementById('remind-days').value) || 0,
                        notes: document.getElementById('item-notes').value
                    };

                    AppData.items.push(item);
                    AppData.saveData();
                    Renderer.renderItemsPage();
                    modal.remove();
                });
            }
        };

        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing app...');
            EventHandler.init();
            Renderer.renderHomePage();
            lucide.createIcons();
        });
    </script>
</body>
</html>
